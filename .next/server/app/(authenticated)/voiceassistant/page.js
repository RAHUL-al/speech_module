(()=>{var e={};e.id=254,e.ids=[254],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1025:(e,t,r)=>{Promise.resolve().then(r.bind(r,7732)),Promise.resolve().then(r.bind(r,2575))},2198:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});let n=(0,r(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/ubuntu/src/app/(authenticated)/voiceassistant/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/ubuntu/src/app/(authenticated)/voiceassistant/page.tsx","default")},2278:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var n=r(687),s=r(3210),a=r(8920),o=r(6001);let i=()=>localStorage.getItem("username")||"unknown_user",c=()=>"",l=["Class 1","Class 2","Class 3","Class 4","Class 5","Class 6","Class 7","Class 8","Class 9","Class 10"],d=["American","British","Australian","Indian","Canadian"],u=["Neutral","Happy","Excited","Calm","Serious","Playful"];function p(){let[e,t]=(0,s.useState)("idle"),[r,p]=(0,s.useState)(0),[m,h]=(0,s.useState)(""),g=(0,s.useRef)(null),f=(0,s.useRef)(null),x=(0,s.useRef)(null),b=(0,s.useRef)(null),v=(0,s.useRef)(null),y=(0,s.useRef)(null),w=(0,s.useRef)(null),j=(0,s.useRef)(null),k=(0,s.useRef)(null),N=(0,s.useRef)([]),C=(0,s.useRef)(null),P=(0,s.useRef)(!1),S=(0,s.useRef)([]),R=(0,s.useRef)(null),[A,I]=(0,s.useState)(l[0]),[E,T]=(0,s.useState)(d[0]),[_,O]=(0,s.useState)(""),[q,M]=(0,s.useState)(u[0]),B=async e=>{try{j.current&&"closed"!==j.current.state||(j.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3}));let t=j.current;"suspended"===t.state&&await t.resume();let r=t.createAnalyser();y.current=r,r.fftSize=256;let n=t.createMediaStreamSource(e);n.connect(r);let s=t.createScriptProcessor(4096,1,1);k.current=s,s.onaudioprocess=e=>{if(P.current)return;let t=e.inputBuffer.getChannelData(0),r=new Int16Array(t.length);for(let e=0;e<t.length;e++){let n=Math.max(-1,Math.min(1,t[e]));r[e]=n<0?32768*n:32767*n}N.current.push(r)},n.connect(s),s.connect(t.destination),L()}catch(e){console.error("Audio processing init error:",e),t("error")}},W=async e=>{if(P.current)return void S.current.push(e);try{t("playing"),P.current=!0,v.current&&v.current.getTracks().forEach(e=>{e.enabled=!1}),R.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});let r=R.current,n=await r.decodeAudioData(e),s=r.createBufferSource();s.buffer=n,s.connect(r.destination),s.start(0),s.onended=()=>{if(v.current&&v.current.getTracks().forEach(e=>{e.enabled=!0}),r.close(),R.current=null,S.current.length>0){let e=S.current.shift();W(e)}else t("connected"),P.current=!1,h("")}}catch(e){console.error("Playback error:",e),v.current&&v.current.getTracks().forEach(e=>{e.enabled=!0}),t("connected"),P.current=!1,R.current&&(R.current.close(),R.current=null),S.current.length>0?W(S.current.shift()):P.current=!1}},D=async()=>{try{t("connecting"),console.log("Getting user media...");let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,noiseSuppression:!0,echoCancellation:!0}});v.current=e,g.current&&(g.current.srcObject=e),await B(e);let r=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});x.current=r,console.log("PeerConnection created"),e.getTracks().forEach(t=>{r.addTrack(t,e)}),r.onconnectionstatechange=()=>{console.log("Connection state:",r.connectionState),("disconnected"===r.connectionState||"failed"===r.connectionState)&&t("error")},r.onicecandidate=e=>{if(e.candidate){let t=b.current;t&&t.readyState===WebSocket.OPEN&&(console.log("Sending ICE candidate",e.candidate),t.send(JSON.stringify({type:"candidate",candidate:e.candidate})))}},r.ontrack=e=>{console.log("Received remote tracks"),f.current&&!f.current.srcObject&&(f.current.srcObject=e.streams[0],f.current.play().catch(e=>console.error("Remote audio play error:",e)))};let n=i(),s=c().replace(/^Bearer\s+/i,""),a=new URL("wss://llm.edusmartai.com/api/ws/assistant");a.searchParams.append("username",n),a.searchParams.append("token",s),a.searchParams.append("student_class",A),a.searchParams.append("accent",E),a.searchParams.append("topic",_),a.searchParams.append("mood",q);let o=new WebSocket(a.toString());b.current=o,o.onopen=()=>{console.log("WebSocket connected"),o.pingInterval=setInterval(()=>{o.readyState===WebSocket.OPEN&&o.send(JSON.stringify({type:"ping"}))},2e3),C.current=setInterval(()=>{if(0===N.current.length||o.readyState!==WebSocket.OPEN)return;let e=[...N.current];N.current=[];let t=e.reduce((e,t)=>e+t.length,0),r=new Int16Array(t),n=0;e.forEach(e=>{r.set(e,n),n+=e.length}),o.send(r.buffer)},3e3),r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!1}).then(e=>(console.log("Created offer:",e),r.setLocalDescription(e))).then(()=>{console.log("Sending offer:",r.localDescription),o.send(JSON.stringify({type:"offer",sdp:r.localDescription.sdp}))}).catch(e=>{console.error("Offer error:",e),t("error")})},o.onmessage=async e=>{if(console.log("WebSocket message:",e.data),e.data instanceof Blob||e.data instanceof ArrayBuffer){console.log("Received audio data");let t=await (e.data instanceof Blob?e.data.arrayBuffer():e.data);W(t)}else if("string"==typeof e.data)try{let n=JSON.parse(e.data);"answer"===n.type?(console.log("Received answer"),await r.setRemoteDescription(new RTCSessionDescription(n)),t("connected")):"candidate"===n.type?(console.log("Received ICE candidate"),await r.addIceCandidate(new RTCIceCandidate(n.candidate))):"transcript"===n.type&&(console.log("Received transcription:",n.text),h(n.text))}catch(e){console.error("Message handling error:",e)}},o.onerror=e=>{console.error("WebSocket error:",e),t("error")},o.onclose=()=>{console.log("WebSocket closed"),t("idle"),z()}}catch(e){console.error("WebRTC setup error:",e),t("error"),z()}},L=()=>{if(!y.current)return;let e=y.current,t=e.frequencyBinCount,r=new Uint8Array(t),n=()=>{w.current=requestAnimationFrame(n),e.getByteFrequencyData(r);let s=0;for(let e=0;e<t;e++)s+=r[e];p(s/t/128)};n()},z=()=>{w.current&&cancelAnimationFrame(w.current),C.current&&(clearInterval(C.current),C.current=null),b.current&&(b.current.pingInterval&&clearInterval(b.current.pingInterval),b.current.close(),b.current=null),k.current&&(k.current.disconnect(),k.current=null),j.current&&(j.current.close().catch(e=>console.error("Error closing audio context:",e)),j.current=null),R.current&&(R.current.close(),R.current=null),x.current&&(x.current.close(),x.current=null),v.current&&(v.current.getTracks().forEach(e=>e.stop()),v.current=null),N.current=[],h("")},G={idle:"bg-gray-500",connecting:"bg-yellow-500",connected:"bg-green-500",playing:"bg-blue-500",error:"bg-red-500"};return(0,n.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-100 flex flex-col items-center justify-center p-4",children:[(0,n.jsxs)("div",{className:"w-full max-w-5xl bg-white/90 backdrop-blur-lg rounded-2xl shadow-xl overflow-hidden",children:[(0,n.jsxs)("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-center",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Speech Assistant"}),(0,n.jsx)("p",{className:"text-indigo-200 mt-1",children:"AI-powered voice assistant"})]}),(0,n.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Assistant Settings"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class"}),(0,n.jsx)("select",{value:A,onChange:e=>I(e.target.value),className:"w-full text-black rounded-lg border border-gray-300 bg-white py-2 px-3 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:l.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Accent"}),(0,n.jsx)("select",{value:E,onChange:e=>T(e.target.value),className:"w-full text-black rounded-lg border border-gray-300 bg-white py-2 px-3 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:d.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]}),(0,n.jsxs)("div",{className:"col-span-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Topic"}),(0,n.jsx)("input",{type:"text",value:_,onChange:e=>O(e.target.value),placeholder:"Enter discussion topic",className:"w-full text-black rounded-lg border border-gray-300 bg-white py-2 px-3 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,n.jsxs)("div",{className:"col-span-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mood"}),(0,n.jsx)("select",{value:q,onChange:e=>M(e.target.value),className:"w-full text-black rounded-lg border border-gray-300 bg-white py-2 px-3 text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:u.map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]})]})]}),(0,n.jsxs)("div",{className:"p-8 flex flex-col items-center",children:[(0,n.jsxs)("div",{className:"relative mb-8",children:[(0,n.jsxs)("div",{className:"w-48 h-48 rounded-full bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center shadow-inner",children:[(0,n.jsx)(a.N,{children:"connected"===e&&(0,n.jsx)(o.P.div,{className:"absolute inset-0 rounded-full bg-indigo-200 opacity-20",animate:{scale:[1,1.3,1]},transition:{duration:2,repeat:1/0}})}),(0,n.jsx)("div",{className:"relative z-10",children:(0,n.jsx)("div",{className:"w-32 h-32 rounded-full bg-white shadow-lg flex items-center justify-center",children:(0,n.jsx)(o.P.button,{onClick:"idle"===e?D:()=>{t("idle"),z()},className:`w-20 h-20 rounded-full flex items-center justify-center focus:outline-none ${"idle"===e?"bg-indigo-100 hover:bg-indigo-200 text-indigo-600":"bg-red-500 hover:bg-red-600 text-white"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:"idle"===e?(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})}):(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})})]}),("connected"===e||"playing"===e)&&(0,n.jsx)("div",{className:"absolute bottom-0 left-0 right-0 flex justify-center space-x-1 h-8",children:Array.from({length:15}).map((t,s)=>(0,n.jsx)(o.P.div,{className:`w-2 rounded-t ${"playing"===e?"bg-blue-500":"bg-indigo-500"}`,animate:{height:Math.max(4,20*r*(s%3==0?1.5:1))},transition:{duration:.1,ease:"easeOut"},style:{originY:1}},s))})]}),(0,n.jsxs)("div",{className:"flex flex-col items-center w-full",children:[(0,n.jsxs)("div",{className:"flex items-center mb-2",children:[(0,n.jsx)(o.P.div,{className:`w-3 h-3 rounded-full mr-2 ${G[e]}`,animate:{scale:[1,1.2,1],opacity:[.7,1,.7]},transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}),(0,n.jsx)("span",{className:"text-gray-700 font-medium",children:{idle:"Ready to start",connecting:"Connecting...",connected:"Listening...",playing:"Assistant is speaking...",error:"Connection error"}[e]})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:(0,n.jsx)(o.P.div,{className:`h-full rounded-full ${G[e]}`,initial:{width:0},animate:{width:"connecting"===e?"60%":"connected"===e||"playing"===e?"100%":"0%"},transition:{duration:"connecting"===e?2:.5,repeat:"connecting"===e?1/0:0,repeatType:"reverse"}})})]}),(0,n.jsxs)("div",{className:"mt-8 text-center text-gray-600 text-sm",children:["idle"===e&&(0,n.jsx)("p",{children:"Click the microphone to start speaking"}),"connected"===e&&(0,n.jsx)("p",{children:"Speak naturally - I'm listening to you"}),"playing"===e&&(0,n.jsx)("p",{children:"Assistant is responding to your question"})]})]}),(0,n.jsx)("div",{className:"bg-gray-50 p-4 text-center text-gray-500 text-sm",children:"Powered by WebRTC & AI"}),(0,n.jsxs)("div",{className:"mt-4 p-4 bg-gray-100 rounded-lg max-w-full",children:[(0,n.jsx)("p",{className:"text-sm text-gray-700 font-semibold",children:"Transcription:"}),(0,n.jsx)("p",{className:"text-gray-600 break-words",children:m})]})]}),(0,n.jsx)("audio",{ref:g,muted:!0,autoPlay:!0,playsInline:!0,className:"hidden"}),(0,n.jsx)("audio",{ref:f,autoPlay:!0,playsInline:!0,className:"hidden"})]})}function m(){return(0,n.jsx)(p,{})}},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},5098:(e,t,r)=>{Promise.resolve().then(r.bind(r,2198))},6454:(e,t,r)=>{Promise.resolve().then(r.bind(r,4426)),Promise.resolve().then(r.bind(r,2359))},8146:(e,t,r)=>{Promise.resolve().then(r.bind(r,2278))},8734:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(7413),s=r(7732),a=r(2575);function o({children:e}){return(0,n.jsx)(s.default,{children:(0,n.jsx)(a.default,{children:e})})}r(1120)},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")},9757:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>l});var n=r(5239),s=r(8088),a=r(8170),o=r.n(a),i=r(893),c={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);r.d(t,c);let l={children:["",{children:["(authenticated)",{children:["voiceassistant",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,2198)),"/home/ubuntu/src/app/(authenticated)/voiceassistant/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,8734)),"/home/ubuntu/src/app/(authenticated)/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,5284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,4431)),"/home/ubuntu/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,5284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["/home/ubuntu/src/app/(authenticated)/voiceassistant/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/(authenticated)/voiceassistant/page",pathname:"/voiceassistant",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[447,43,658,868,336,437,752],()=>r(9757));module.exports=n})();