(()=>{var e={};e.id=73,e.ids=[73],e.modules={296:(e,t,r)=>{"use strict";r.d(t,{k5:()=>d});var n=r(3210),o={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},a=n.createContext&&n.createContext(o),s=["attr","size","title"];function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){var n,o,a;n=e,o=t,a=r[t],(o=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(o))in n?Object.defineProperty(n,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[o]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e){return t=>n.createElement(u,i({attr:c({},e.attr)},t),function e(t){return t&&t.map((t,r)=>n.createElement(t.tag,c({key:r},t.attr),e(t.child)))}(e.child))}function u(e){var t=t=>{var r,{attr:o,size:a,title:l}=e,d=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,s),u=a||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),n.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,o,d,{className:r,style:c(c({color:e.color||t.color},t.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),l&&n.createElement("title",null,l),e.children)};return void 0!==a?n.createElement(a.Consumer,null,e=>t(e)):t(o)}},469:(e,t,r)=>{Promise.resolve().then(r.bind(r,8154))},741:(e,t,r)=>{Promise.resolve().then(r.bind(r,5623))},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1025:(e,t,r)=>{Promise.resolve().then(r.bind(r,7732)),Promise.resolve().then(r.bind(r,2575))},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{"use strict";e.exports=require("path")},5623:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var n=r(687),o=r(3210),a=r(5533),s=r(182),i=r(6189),l=r(9587),c=r(6001),d=r(7590);let u=()=>{let e=(0,a.jL)(),t=(0,i.useRouter)(),r=(0,i.useSearchParams)(),[u,p]=(0,o.useState)(!1),[h,m]=(0,o.useState)(!1),[f,g]=(0,o.useState)(null),x=(0,o.useRef)(null),[b,v]=(0,o.useState)(!1),y=r.get("essay_id"),w=r.get("paragraph")?decodeURIComponent(r.get("paragraph")):null,[j,P]=(0,o.useState)(null),[N,k]=(0,o.useState)(!1);(0,o.useRef)(null);let O=(0,o.useRef)(null),S=(0,o.useRef)(null),A=(0,o.useRef)([]),[C,R]=(0,o.useState)(!0),E=()=>localStorage.getItem("username")||"unknown_user",L=(0,o.useRef)(null),_=(0,o.useRef)(null),{isRecording:I,isAnalyzing:U,analysisResults:z,error:W}=(0,a.GV)(e=>e.practice),T=()=>"",D=async()=>{let e=T(),t=E();if(!t||!e)return void d.Ay.error("Authentication required");m(!0);try{let r=process.env.NEXT_PUBLIC_API_URL||"api/",n=await fetch(`${r}/get-tts-audio?username=${t}`,{headers:{Authorization:`${e}`}});if(!n.ok)throw Error("Audio fetch failed");let o=await n.blob(),a=URL.createObjectURL(o);return f&&URL.revokeObjectURL(f),g(a),a}catch(e){return d.Ay.error("Failed to load audio: "+e.message),null}finally{m(!1)}},M=async()=>{if(x.current)if(u)x.current.pause(),p(!1);else try{let e=f;e||(e=await D()),e&&x.current&&(x.current.src!==e&&(x.current.src=e),await x.current.play(),p(!0))}catch(e){console.error("Audio playback failed:",e),d.Ay.error("Failed to play audio")}},q=process.env.NEXT_PUBLIC_API_URL;if(!q){console.error("âŒ NEXT_PUBLIC_API_URL is not defined"),d.Ay.error("Configuration error: API URL missing");return}let G=(0,o.useCallback)(async()=>{E()},[q]),$=async()=>{try{let e=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"audioinput"===e.kind);if(0===e.length)return d.Ay.error("No microphones detected"),!1;return console.log("Available microphones:",e),!0}catch(e){return console.error("Device enumeration error:",e),d.Ay.error("Couldn't access device list"),!1}};(0,o.useEffect)(()=>{},[e,w,t,G]),(0,o.useEffect)(()=>{W&&d.Ay.error(W)},[W]);let B=async()=>{if(R(!1),P(null),A.current=[],await $())try{let t=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,noiseSuppression:!0,echoCancellation:!0}}),r=t.getAudioTracks();console.log("Active audio tracks:",r),r.forEach(e=>{console.log("Track settings:",e.getSettings()),console.log("Track enabled:",e.enabled),console.log("Track readyState:",e.readyState)}),L.current=t;let n=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});O.current=n;let o=n.createMediaStreamSource(t),a=n.createScriptProcessor(4096,1,1);S.current=a,a.onaudioprocess=e=>{let t=e.inputBuffer.getChannelData(0),r=new Int16Array(t.length);for(let e=0;e<t.length;e++){let n=Math.max(-1,Math.min(1,t[e]));r[e]=n<0?32768*n:32767*n}A.current.push(r)},o.connect(a),a.connect(n.destination);let i=T();if(!i)return void d.Ay.error("Missing authentication token");let l=E();console.log("Using username:",l);let c=q.replace(/^https?:\/\//,""),u=(window.location.protocol,"wss:"),p=new URLSearchParams({username:encodeURIComponent(l),token:encodeURIComponent(i)}),h=new WebSocket(`${u}//${c}/ws/audio?${p.toString()}`);console.log("Connecting to:",h.url),_.current=h,h.onopen=()=>{console.log("WebSocket connected"),console.log("Protocol:",h.protocol),console.log("Extensions:",h.extensions),e((0,s.K3)()),setInterval(()=>{if(0===A.current.length||h.readyState!==WebSocket.OPEN)return;let e=A.current;A.current=[];let t=e.reduce((e,t)=>e+t.length,0),r=new Int16Array(t),n=0;e.forEach(e=>{r.set(e,n),n+=e.length}),h.send(r.buffer)},3e3)},h.onmessage=t=>{let r=JSON.parse(t.data);console.log("Analysis received:",r),e((0,s.LN)(r))},h.onerror=t=>{console.error("WebSocket error:",t),d.Ay.error("WebSocket connection error"),e((0,s.Ww)())},h.onclose=e=>{console.error("WebSocket closed unexpectedly",{code:e.code,reason:e.reason,wasClean:e.wasClean})};let m=new FileReader;m.onload=()=>{h.readyState===WebSocket.OPEN&&(console.log("Sending audio chunk as ArrayBuffer"),h.send(m.result))},o.connect(a),a.connect(n.destination)}catch(t){console.error("Recording error:",t),d.Ay.error("Failed to access microphone. Please check permissions."),e((0,s.Ww)())}};return(0,o.useEffect)(()=>{let e=x.current;return()=>{e&&e.pause(),_.current&&_.current.close(),L.current&&L.current.getTracks().forEach(e=>e.stop())}},[e]),(0,o.useEffect)(()=>()=>{j&&URL.revokeObjectURL(j)},[j]),(0,o.useEffect)(()=>()=>{f&&URL.revokeObjectURL(f)},[f]),(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center px-4 py-8",children:(0,n.jsxs)(c.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-3xl bg-white shadow-xl rounded-xl overflow-hidden",children:[(0,n.jsxs)("div",{className:"bg-indigo-600 py-4 px-6 flex items-center",children:[(0,n.jsx)("button",{onClick:()=>{x.current&&u&&x.current.pause(),e((0,s.Ct)()),t.push("/dashboard")},className:"text-white mr-4 p-2 rounded-full hover:bg-indigo-700 transition-colors",children:(0,n.jsx)(l.QVr,{})}),(0,n.jsx)("h2",{className:"text-2xl font-bold text-white text-center flex-grow",children:"Practice Your English"})]}),(0,n.jsx)("div",{className:"p-6",children:U&&!w?(0,n.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"}),(0,n.jsx)("span",{className:"ml-4 text-gray-700",children:"Loading practice session..."})]}):(0,n.jsxs)(n.Fragment,{children:[!I&&(0,n.jsxs)("div",{className:"mb-8 bg-indigo-50 p-4 rounded-xl border border-indigo-100 transition-all duration-500",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-indigo-800 mb-3",children:"Read this paragraph aloud:"}),(0,n.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-inner max-h-60 overflow-y-auto",children:(0,n.jsx)("p",{className:"text-gray-700 leading-relaxed whitespace-pre-line",children:w})})]}),(0,n.jsxs)("div",{className:"mb-8 flex justify-center",children:[(0,n.jsxs)("button",{onClick:M,disabled:h||I,className:`flex items-center justify-center ${h?"bg-gray-300 cursor-not-allowed":"bg-indigo-100 hover:bg-indigo-200"} text-indigo-600 p-4 rounded-full transition-colors min-w-[180px]`,children:[h?(0,n.jsx)(l.hW,{className:"animate-spin text-xl"}):u?(0,n.jsx)(l.kwt,{className:"text-xl"}):(0,n.jsx)(l.gSK,{className:"text-xl"}),(0,n.jsx)("span",{className:"ml-2",children:h?"Loading...":u?"Pause":"Listen Again"})]}),(0,n.jsx)("audio",{ref:x,src:f,onPlay:()=>p(!0),onPause:()=>p(!1),onEnded:()=>p(!1),onLoadedData:()=>m(!1),onWaiting:()=>m(!0),onCanPlay:()=>m(!1),className:"hidden"})]}),(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center my-8",children:[C&&!I&&(0,n.jsx)(c.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-yellow-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsx)("p",{className:"text-sm text-yellow-700",children:"The paragraph will be hidden when you start recording to encourage memorization and natural speech."})})]})}),I?(0,n.jsx)(c.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{if(R(!1),S.current&&(S.current.disconnect(),S.current=null),O.current&&(O.current.close(),O.current=null),L.current&&L.current.getTracks().forEach(e=>e.stop()),_.current){let e=_.current;if(A.current.length>0&&e.readyState===WebSocket.OPEN){let t=A.current;A.current=[];let r=new Int16Array(t.reduce((e,t)=>e+t.length,0)),n=0;t.forEach(e=>{r.set(e,n),n+=e.length}),e.send(r.buffer)}e.sendInterval&&clearInterval(e.sendInterval),e.readyState===WebSocket.OPEN?(e.send(JSON.stringify({action:"end"})),e.close(1e3,"Recording completed")):e.close()}e((0,s.Ww)()),v(!0)},className:"bg-gradient-to-r from-red-500 to-orange-500 text-white rounded-full p-6 shadow-lg hover:shadow-xl transition-all duration-300",children:(0,n.jsx)(l.wFo,{className:"text-3xl"})}):(0,n.jsx)(c.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:B,className:"bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-full p-6 shadow-lg hover:shadow-xl transition-all duration-300",disabled:U,children:(0,n.jsx)(l.i0t,{className:"text-3xl"})}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:I?"Recording... Click to stop.":"Click the microphone to start recording."}),I&&(0,n.jsx)("div",{className:"mt-4 flex space-x-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsx)(c.P.div,{animate:{height:[10,30,10]},transition:{duration:1,repeat:1/0,delay:.2*t},className:"w-3 bg-indigo-500 rounded-full"},t))}),b&&(0,n.jsx)(c.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-8 flex justify-center",children:(0,n.jsxs)("button",{onClick:()=>{if(!y)return void d.Ay.error("Essay ID is missing");e((0,s.LN)({isAnalyzing:!0})),e((0,s.hG)(y)).unwrap().then(r=>{e((0,s.LN)({results:r,isAnalyzing:!1})),t.push(`/result?essayId=${y}`)}).catch(t=>{d.Ay.error("Failed to fetch results: "+t.message),e((0,s.LN)({isAnalyzing:!1}))})},disabled:U,className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-8 py-4 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 text-lg font-semibold flex items-center disabled:opacity-75",children:[U?(0,n.jsx)(l.hW,{className:"animate-spin mr-2"}):null,"See Detailed Results",!U&&(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z",clipRule:"evenodd"})})]})})]})]})})]})})};function p(){return(0,n.jsx)(u,{})}},6454:(e,t,r)=>{Promise.resolve().then(r.bind(r,4426)),Promise.resolve().then(r.bind(r,2359))},6647:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>s.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var n=r(5239),o=r(8088),a=r(8170),s=r.n(a),i=r(893),l={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(t,l);let c={children:["",{children:["(authenticated)",{children:["practice",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,8154)),"/home/ubuntu/src/app/(authenticated)/practice/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,8734)),"/home/ubuntu/src/app/(authenticated)/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,5284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,4431)),"/home/ubuntu/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,5284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["/home/ubuntu/src/app/(authenticated)/practice/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:o.RouteKind.APP_PAGE,page:"/(authenticated)/practice/page",pathname:"/practice",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},8154:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});let n=(0,r(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/ubuntu/src/app/(authenticated)/practice/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/ubuntu/src/app/(authenticated)/practice/page.tsx","default")},8734:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(7413),o=r(7732),a=r(2575);function s({children:e}){return(0,n.jsx)(o.default,{children:(0,n.jsx)(a.default,{children:e})})}r(1120)},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[447,43,658,868,336,587,437,752],()=>r(6647));module.exports=n})();